<!DOCTYPE html>
<html>
<head>
    <title>Admin Setup</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        button { background: #2962FF; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; }
        #status { margin-top: 20px; padding: 15px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Admin Account Setup</h1>
    <button id="setupAdmin">Setup Admin User</button>
    <div id="status"></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAMU2y175sXjHkxAv6SF88-E9FCjaR2kJc",
            authDomain: "geocarrental-9a4de.firebaseapp.com",
            projectId: "geocarrental-9a4de",
            storageBucket: "geocarrental-9a4de.appspot.com",
            messagingSenderId: "951760186950",
            appId: "1:951760186950:web:7e8cc25aacdd251f152447",
            measurementId: "G-LJEF344295"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        document.getElementById('setupAdmin').addEventListener('click', async () => {
            const statusEl = document.getElementById('status');
            statusEl.className = 'info';
            statusEl.innerHTML = 'Starting admin setup...';
            
            try {
                const email = "admin@geo.com";
                const password = "admin@geo.com";
                let user;
                const actions = [];

                // 1. Handle authentication
                try {
                    user = (await auth.createUserWithEmailAndPassword(email, password)).user;
                    actions.push('‚úÖ Created new auth user');
                } catch (error) {
                    if (error.code === 'auth/email-already-in-use') {
                        user = (await auth.signInWithEmailAndPassword(email, password)).user;
                        actions.push('‚ÑπÔ∏è Using existing auth user');
                    } else throw error;
                }

                // 2. Set Firestore admin record
                await db.collection('users').doc(user.uid).set({
                    email: email,
                    name: "Admin User",
                    role: "admin",
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                actions.push('‚úÖ Updated Firestore with admin role');

                // 3. Complete
                await auth.signOut();
                actions.push('üîí Signed out for security');

                statusEl.className = 'success';
                statusEl.innerHTML = `
                    <strong>Admin setup complete!</strong>
                    <ul>${actions.map(a => `<li>${a}</li>`).join('')}</ul>
                    <p>Email: <code>${email}</code></p>
                    <p>Password: <code>${password}</code></p>
                    <p>User ID: <code>${user.uid}</code></p>
                `;
                
            } catch (error) {
                statusEl.className = 'error';
                statusEl.innerHTML = `
                    <strong>Error during setup:</strong>
                    <p>${error.message}</p>
                    ${error.code ? `<p>Code: ${error.code}</p>` : ''}
                `;
                console.error(error);
            }
        });
    </script>
</body>
</html>